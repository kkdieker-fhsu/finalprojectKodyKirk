{% extends 'base.html' %}

{% block content %}
    <h2>Traffic Logs</h2>

    <table id="traffic_table" class="table table-striped table-bordered" style="width:100%">
        <thead>
            <tr>
                <th>Source IP</th>
                <th>Destination IP</th>
                <th>Data In (Bytes)</th>
                <th>Data Out (Bytes)</th>
                <th>Protocols</th>
                <th>Malicious Hits</th>
            </tr>
        </thead>

        <tbody>
            {% if pairs %}
                {% for pair in pairs %}
                    <tr>
                        <td>
                            <a href="{% url 'dash:detail' pair.ip_src.ip_address %}">
                                {{ pair.ip_src }}
                            </a>
                        </td>
                        <td>
                            {% if pair.ip_dst %}
                                <a href="{% url 'dash:detail' pair.ip_dst %}">
                                    {{ pair.ip_dst }}
                                </a>
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                        <td>{{ pair.data_in }}</td>
                        <td>{{ pair.data_out }}</td>
                        <td>{{ pair.protocol }}</td>
                        <td data-order="{{ pair.dst_malicious|default_if_none:'-1' }}">
                            {% if pair.dst_malicious is not None and pair.dst_malicious > 0 %}
                                <p style="color: red;">{{ pair.dst_malicious }}</p>
                            {% elif pair.dst_malicious is not None %}
                                <p style="color: green;">{{ pair.dst_malicious }}</p>
                            {% else %}
                                Not Scanned
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            {% endif %}
        </tbody>
    </table>

{% endblock %}

{% block scripts %}
    <script>
        $(document).ready(function() {
            $('#traffic_table').DataTable();
        });
    </script>
{% endblock %}
